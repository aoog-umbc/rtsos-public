MODULE US_Standard_Atmosphere
IMPLICIT NONE

INTEGER,PARAMETER :: NPGRID_US_STD_ATMOS=50
REAL*8,DIMENSION(NPGRID_US_STD_ATMOS) :: PRESSURE_US,Z_FIELD_US,T_FIELD_US, &
                  NUMDEN_TOTAL_FIELD_US,NUMDEN_OZONE_FIELD_US,NUMDEN_OXYGEN_FIELD_US,&
                  NUMDEN_H2O_FIELD_US,NUMDEN_CO2_FIELD_US,NUMDEN_NO2_FIELD_US,       &
                  NUMDEN_CH4_FIELD_US
CONTAINS
SUBROUTINE US_STD_ATMOS_READIN(NPGRID,P_GRID,Z_FIELD,TEM_FIELD,            &
                       NUMDEN_TOTAL_FIELD,VMR_OZONE_FIELD,VMR_OXYGEN_FIELD,&
                       VMR_H2O_FIELD,VMR_CO2_FIELD,VMR_NO2_FIELD,VMR_CH4_FIELD)

INTEGER, INTENT(IN) :: NPGRID
REAL*8,DIMENSION(NPGRID),INTENT(OUT) :: P_GRID,Z_FIELD,TEM_FIELD,            &
       NUMDEN_TOTAL_FIELD,VMR_OZONE_FIELD,VMR_OXYGEN_FIELD,&
       VMR_H2O_FIELD,VMR_CO2_FIELD,VMR_NO2_FIELD,       &
       VMR_CH4_FIELD

CHARACTER(LEN=180) ::atmos_dir,atmos_profile_file,atmos_ch4_file
INTEGER,PARAMETER :: NHEADER=2
REAL*8,DIMENSION(9) :: RARRY

INTEGER :: ITEMP

IF(NPGRID.NE.NPGRID_US_STD_ATMOS)THEN
  WRITE(*,*) 'NPGRID.NE.NPGRID_US_STD_ATMOS'
  WRITE(*,*) 'REDEFINE NPGRID IN GLOBAL DATA AND RECOMPILE'
  STOP
ENDIF

OPEN(unit=1,file='gas_absorption_coeff_dir',status='old');
READ(1,'(A)')atmos_dir
CLOSE(1)
atmos_dir=TRIM(atmos_dir)//'/atmmod/'
atmos_profile_file='afglus.dat'
!write(*,*)'atmos_dir,atmos_profile_file=',atmos_dir,atmos_profile_file

atmos_profile_file=trim(atmos_dir)//trim(atmos_profile_file)
atmos_ch4_file='afglus_ch4_vmr.dat'
atmos_ch4_file=trim(atmos_dir)//trim(atmos_ch4_file)

!write(*,*)'atmos_profile_file=',atmos_profile_file

OPEN(unit=1,file=atmos_profile_file,status='old',action='read')
DO ITEMP=1,NHEADER
  READ(1,*)
ENDDO

DO ITEMP=1,NPGRID_US_STD_ATMOS
  READ(1,*)RARRY(1:9)
  Z_FIELD_US(ITEMP)=RARRY(1)
  PRESSURE_US(ITEMP)=RARRY(2)*100.0D0
  T_FIELD_US(ITEMP)=RARRY(3)
  NUMDEN_TOTAL_FIELD_US(ITEMP)=RARRY(4)*1.0E6
  NUMDEN_OZONE_FIELD_US(ITEMP)=RARRY(5)*1.0E6
  NUMDEN_OXYGEN_FIELD_US(ITEMP)=RARRY(6)*1.0E6
  NUMDEN_H2O_FIELD_US(ITEMP)=RARRY(7)*1.0E6
  NUMDEN_CO2_FIELD_US(ITEMP)=RARRY(8)*1.0E6
  NUMDEN_NO2_FIELD_US(ITEMP)=RARRY(9)*1.0E6
ENDDO
CLOSE(1)

OPEN(unit=1,file=atmos_ch4_file,status='old',action='read');
DO ITEMP=1,NHEADER
  READ(1,*)
ENDDO

DO ITEMP=1,NPGRID_US_STD_ATMOS
READ(1,*)RARRY(1:2)
  NUMDEN_CH4_FIELD_US(ITEMP)=RARRY(2)*NUMDEN_TOTAL_FIELD_US(ITEMP)
ENDDO
CLOSE(1)

P_GRID=PRESSURE_US
Z_FIELD=Z_FIELD_US
TEM_FIELD=T_FIELD_US
NUMDEN_TOTAL_FIELD=NUMDEN_TOTAL_FIELD_US
VMR_OZONE_FIELD=NUMDEN_OZONE_FIELD_US/NUMDEN_TOTAL_FIELD_US
VMR_OXYGEN_FIELD=NUMDEN_OXYGEN_FIELD_US/NUMDEN_TOTAL_FIELD_US
VMR_H2O_FIELD=NUMDEN_H2O_FIELD_US/NUMDEN_TOTAL_FIELD_US
VMR_CO2_FIELD=NUMDEN_CO2_FIELD_US/NUMDEN_TOTAL_FIELD_US
VMR_NO2_FIELD=NUMDEN_NO2_FIELD_US/NUMDEN_TOTAL_FIELD_US
VMR_CH4_FIELD=NUMDEN_CH4_FIELD_US/NUMDEN_TOTAL_FIELD_US

END SUBROUTINE US_STD_ATMOS_READIN

END MODULE US_Standard_Atmosphere
