MODULE PACE_INSTRUMENT_DESIGN
INTEGER,PARAMETER :: NWV_BAND=129,NWV_BAND_SEG1=110,NWV_BAND_SEG2=7,NWV_BAND_SEG3=12

REAL*8,PARAMETER :: WV_START=340D0 !,WV_END=1000.D0

REAL*8,DIMENSION(NWV_BAND):: WV_BAND,PACE_FWHM=0.0d0

INTEGER,PARAMETER :: NILS_PACE=200
REAL*8,DIMENSION(NWV_BAND,NILS_PACE) :: ILS_DeltaWaveLength,ILS_PACE

CONTAINS

SUBROUTINE WV_PACE_SETUP
IMPLICIT NONE
INTEGER :: IWV

IF(NWV_BAND_SEG2 /= 7)STOP 'CHECK NWV AND NWV_SEG2'
IF(NWV_BAND /= NWV_BAND_SEG1+NWV_BAND_SEG2+NWV_BAND_SEG3) STOP 'CHECK NWV'

IF(ABS(PACE_FWHM(1))<1.0E-6)STOP 'PACE_FWHM IS NOT INITIALIZED'

WV_BAND(1)=WV_START
DO IWV=2,NWV_BAND_SEG1
  WV_BAND(IWV)=WV_BAND(IWV-1)+PACE_FWHM(IWV)
ENDDO

WV_BAND(NWV_BAND_SEG1+1)=940d0
WV_BAND(NWV_BAND_SEG1+2)=1038d0
WV_BAND(NWV_BAND_SEG1+3)=1250d0
WV_BAND(NWV_BAND_SEG1+4)=1378d0
WV_BAND(NWV_BAND_SEG1+5)=1615d0
WV_BAND(NWV_BAND_SEG1+6)=2130d0
WV_BAND(NWV_BAND_SEG1+7)=2260d0

WV_BAND(NWV_BAND-NWV_BAND_SEG3+1:NWV_BAND)=&
  (/385d0, 410d0, 441d0,451.5d0, 470d0,510d0, 549d0, &
	555d0, 669d0, 765d0, 863.5d0, 873d0/)

END SUBROUTINE WV_PACE_SETUP

SUBROUTINE PACE_FWHM_INIT
IMPLICIT NONE
PACE_FWHM(1:NWV_BAND_SEG1)=5.0d0

PACE_FWHM(NWV_BAND_SEG1+1)=45.0D0
PACE_FWHM(NWV_BAND_SEG1+2)=75.0D0
PACE_FWHM(NWV_BAND_SEG1+3)=30.0D0
PACE_FWHM(NWV_BAND_SEG1+4)=15.0D0
PACE_FWHM(NWV_BAND_SEG1+5)=75.0D0
PACE_FWHM(NWV_BAND_SEG1+6)=50.0D0
PACE_FWHM(NWV_BAND_SEG1+7)=75.0D0

PACE_FWHM(NWV_BAND_SEG1+NWV_BAND_SEG2+1:NWV_BAND)=20.0d0

END SUBROUTINE PACE_FWHM_INIT

SUBROUTINE ILS_INIT
IMPLICIT NONE
INTEGER IWV,ILS_LINE
REAL*8 Delta_Wavelength_Max,Delta_Wavelength_Sub,Factor


ILS_DeltaWaveLength=0.0d0
DO IWV=1,NWV_BAND

Delta_Wavelength_Max=2.0d0*PACE_FWHM(IWV)
Delta_Wavelength_Sub=Delta_Wavelength_Max/(1.0d0*NILS_PACE)
Factor=4.0D0*log(2.0D0)/(PACE_FWHM(IWV)**2)

DO ILS_LINE=1,NILS_PACE
   ILS_DeltaWaveLength(IWV,ILS_LINE)=(ILS_LINE-NILS_PACE/2)*Delta_Wavelength_Sub
   ILS_PACE(IWV,ILS_LINE)=exp(-Factor*(ILS_DeltaWaveLength(IWV,ILS_LINE)**2));
ENDDO
ENDDO

END SUBROUTINE ILS_INIT


END MODULE PACE_INSTRUMENT_DESIGN
