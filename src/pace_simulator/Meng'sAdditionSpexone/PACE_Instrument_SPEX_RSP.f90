MODULE PACE_INSTRUMENT_DESIGN
  !INTEGER,PARAMETER :: NWV_BAND=128,NWV_BAND_SEG2=6,NWV_BAND_SEG3=12

  !modify seg3 for RSP(9) band and SPEX (109)
  INTEGER,PARAMETER :: NWV_BAND=124,NWV_BAND_SEG2=6,NWV_BAND_SEG3=9

  REAL*8,PARAMETER :: WV_START=350D0,WV_END=1000.D0 !,WV_BAND_WIDTH=5D0

  REAL*8,DIMENSION(NWV_BAND):: WV_BAND, WV_BAND_WIDTH !define a band width array

  INTEGER,PARAMETER :: NILS_PACE=200
  REAL*8,DIMENSION(NWV_BAND,NILS_PACE) :: ILS_DeltaWaveLength,ILS_PACE

CONTAINS

  SUBROUTINE WV_PACE_SETUP
    IMPLICIT NONE
    INTEGER :: IWV

    IF(NWV_BAND_SEG2 /= 6)STOP 'CHECK NWV AND NWV_SEG2'

    !pace
    !    DO IWV=1,NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3
    !       WV_BAND(IWV)=WV_START+(IWV-1.0D0)*WV_BAND_WIDTH
    !    ENDDO

    !SPEX
    WV_BAND_WIDTH(1:109)=2.0d0
    WV_BAND(1:109)=(/ &
         398.33292, 399.9715 , 401.88248, 403.79266, 405.9748 , 407.8833, &
         409.79105, 411.698  , 413.87634, 415.78156, 417.95795, 419.86145,&
         422.03586, 424.20917, 426.38144, 428.55258, 430.72266, 432.89166,&
         435.0595 , 437.2263 , 439.66257, 441.82693, 444.26053, 446.4225 ,&
         448.85336, 451.2828 , 453.71072, 456.1372 , 458.5622 , 460.98572,&
         463.67673, 466.09705, 468.78455, 471.47015, 473.88556, 476.5676 ,&
         479.2476 , 482.19348, 484.86945, 487.54352, 490.48267, 493.4194 ,&
         496.08716, 499.01926, 501.949  , 505.14224, 508.06677, 511.25433,&
         514.17365, 517.35547, 520.53424, 523.97455, 527.147  , 530.58026,&
         533.7462 , 537.1725 , 540.5949 , 544.2766 , 547.69135, 551.36456,&
         554.77136, 558.43604, 562.3574 , 566.0128 , 569.9241 , 573.83014,&
         577.7309 , 581.62634, 585.77545, 589.9184 , 594.05505, 598.1855 ,&
         602.5672 , 606.9416 , 611.3088 , 615.66864, 620.27686, 624.8768 ,&
         629.46826, 634.0513 , 638.87946, 643.6982 , 648.7601 , 653.811  ,&
         658.851  , 664.1311 , 669.39905, 674.6544 , 680.1468 , 685.62524,&
         691.3377 , 697.0348 , 702.71625, 708.62805, 714.52264, 720.6441 ,&
         726.7465 , 733.0726 , 739.6196 , 746.1436 , 752.8847 , 759.6006 ,&
         766.5294 , 773.668  , 780.77686, 788.09076, 795.3721 , 803.0868 ,&
         810.53174 /)

    ! replace original pace swir bands with rsp, uv and IR bands
    
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+1)=410.27d0
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+2)=863.51d0
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+3)=960.0d0
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+4)=1593.51d0
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+5)=1880.0d0
    WV_BAND(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+6)=2263.51d0
    WV_BAND_WIDTH(NWV_BAND-NWV_BAND_SEG2-NWV_BAND_SEG3+1:NWV_BAND-NWV_BAND_SEG3)=&
         (/30.0d0, 20.0d0, 20.0d0, 60.0d0, 90.0d0, 120.0d0/)

    !unknown bands? for pace simulation?
    !WV_BAND(NWV_BAND-NWV_BAND_SEG3+1:NWV_BAND)=&
    !  (/340d0, 354d0, 388d0, 416d0, 442d0,451.5d0, 470d0,  &
    !    510d0, 551d0, 670d0, 765d0, 865d0/)

    !set up rsp band !compare with seg2 bands

    WV_BAND(NWV_BAND-NWV_BAND_SEG3+1:NWV_BAND)=&
         (/410.27d0,   469.13d0,   554.96d0,   670.01d0, &
         863.51d0,   960.0d0,  1593.51d0,  1880.0d0, 2263.51d0/)
    WV_BAND_WIDTH(NWV_BAND-NWV_BAND_SEG3+1:NWV_BAND)=(/30d0, 20d0, 20d0, 20d0, 20d0, 20d0, 60d0, 90d0, 120d0/)
  END SUBROUTINE WV_PACE_SETUP

  SUBROUTINE ILS_INIT
    IMPLICIT NONE
    INTEGER IWV,ILS_LINE, I
    REAL*8 Delta_Wavelength_Max,Delta_Wavelength_Sub,Factor
    REAL*8 PACE_FWHM,RSP_FWHM

    ILS_DeltaWaveLength=0.0d0
    DO IWV=1,NWV_BAND
       !PACE_FWHM=5.0d0
       !PACE_FWHM=0.1d0
       PACE_FWHM=WV_BAND_WIDTH(IWV)
       Delta_Wavelength_Max=4.0d0*PACE_FWHM
       Delta_Wavelength_Sub=Delta_Wavelength_Max/(1.0d0*NILS_PACE)
       
       Factor=4.0D0*log(2.0D0)/(PACE_FWHM**2)
       DO ILS_LINE=1,NILS_PACE
          ILS_DeltaWaveLength(IWV,ILS_LINE)=(ILS_LINE-NILS_PACE/2)*Delta_Wavelength_Sub
          ILS_PACE(IWV,ILS_LINE)=exp(-Factor*(ILS_DeltaWaveLength(IWV,ILS_LINE)**2));
       ENDDO
    ENDDO

  END SUBROUTINE ILS_INIT


END MODULE PACE_INSTRUMENT_DESIGN
