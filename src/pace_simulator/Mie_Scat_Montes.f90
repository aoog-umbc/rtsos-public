Module Mie_Scat_Montes
  implicit none
  INTEGER, PARAMETER :: NTYPE=27
  REAL*8,DIMENSION(NTYPE) :: MM_SSA_440=(/0.93d0,0.86d0,0.93d0,0.88d0,&
       0.82d0,0.90d0,0.97d0,0.91d0,0.90d0,0.93d0,0.96d0,0.85d0,0.97d0,&
       0.97d0,0.94d0,0.88d0,0.98d0,0.80d0,0.99d0,0.99d0,0.95d0,0.93d0,&
       0.86d0,0.90d0,0.92d0,0.94d0,0.97d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_AEe=(/0.273d0,0.600d0,0.593d0,0.343d0,& 
       0.707d0,0.963d0,0.370d0,0.687d0,0.270d0,1.289d0,1.384d0,1.326d0,&
       0.859d0,1.615d0,1.031d0,1.184d0,1.238d0,1.395d0,1.821d0,1.289d0,&
       1.924d0,1.819d0,1.731d0,1.651d0,1.456d0,1.631d0,1.879d0 /)
  REAL*8,DIMENSION(NTYPE) :: MM_AEa=(/2.572d0,1.640d0,2.186d0,1.990d0,&
       1.421d0,1.452d0,1.637d0,1.772d0,2.463d0,1.141d0,0.975d0,1.337d0,&
       1.237d0,0.980d0,1.389d0,1.250d0,0.967d0,1.339d0,1.126d0,1.062d0,&
       1.077d0,1.094d0,1.294d0,1.192d0,1.119d0,0.996d0,1.114d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_FCV_f=(/0.11d0,0.17d0,0.17d0,0.11d0,0.19d0,&
       0.25d0,0.12d0,0.19d0,0.10d0,0.43d0,0.51d0,0.42d0,0.27d0,0.59d0, &
       0.32d0,0.35d0,0.44d0,0.45d0,0.68d0,0.58d0,0.65d0,0.61d0,0.58d0, &
       0.55d0,0.48d0,0.57d0,0.66d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_rn_f=(/0.04d0,0.06d0,0.06d0,0.05d0,0.06d0,&
       0.08d0,0.06d0,0.07d0,0.04d0,0.10d0,0.10d0,0.08d0,0.08d0,0.10d0, &
       0.09d0,0.08d0,0.10d0,0.08d0,0.11d0,0.10d0,0.10d0,0.10d0,0.09d0, &
       0.09d0,0.09d0,0.10d0,0.11d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_sigman_f=(/0.63d0,0.52d0,0.52d0,0.60d0,&
       0.51d0,0.47d0,0.58d0,0.49d0,0.63d0,0.46d0,0.46d0,0.47d0,0.49d0, &
       0.43d0,0.47d0,0.47d0,0.46d0,0.47d0,0.41d0,0.45d0,0.40d0,0.41d0, &
       0.42d0,0.43d0,0.45d0,0.43d0,0.40d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_rn_c=(/0.73d0,0.72d0,0.70d0,0.75d0,0.70d0, &
      0.69d0,0.73d0,0.70d0,0.75d0,0.76d0,0.77d0,0.78d0,0.71d0,0.78d0,   &
      0.70d0,0.75d0,0.76d0,0.81d0,0.86d0,0.83d0,0.85d0,0.84d0,0.83d0,   &
      0.82d0,0.76d0,0.82d0,0.87d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_sigman_c=(/0.58d0,0.64d0,0.62d0,0.6d0, &
       0.65d0,0.66d0,0.58d0,0.63d0,0.59d0,0.65d0,0.65d0,0.67d0,0.63d0, &
       0.66d0,0.65d0,0.67d0,0.63d0,0.67d0,0.64d0,0.63d0,0.66d0,0.66d0, &
       0.68d0,0.67d0,0.66d0,0.65d0,0.65d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_nr440=(/1.465d0,1.488d0,1.465d0,1.481d0, &
      1.498d0,1.496d0,1.468d0,1.471d0,1.473d0,1.466d0,1.450d0,1.493d0,&
      1.447d0,1.441d0,1.462d0,1.502d0,1.446d0,1.496d0,1.417d0,1.421d0,&
      1.471d0,1.481d0,1.502d0,1.473d0,1.471d0,1.457d0,1.445d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_ni440=(/0.003d0,0.009d0,0.004d0,0.006d0, &
      0.016d0,0.008d0,0.001d0,0.005d0,0.004d0,0.007d0,0.005d0,0.023d0,&
      0.002d0,0.004d0,0.005d0,0.014d0,0.002d0,0.033d0,0.002d0,0.002d0,&
      0.007d0,0.011d0,0.025d0,0.015d0,0.011d0,0.008d0,0.004d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_nr870=(/1.470d0,1.525d0,1.463d0,1.502d0,&
      1.532d0,1.510d0,1.478d0,1.503d0,1.482d0,1.468d0,1.447d0,1.514d0,&
      1.459d0,1.439d0,1.468d0,1.517d0,1.446d0,1.520d0,1.425d0,1.429d0,&
      1.453d0,1.463d0,1.513d0,1.470d0,1.467d0,1.445d0,1.435d0/)  
  REAL*8,DIMENSION(NTYPE) :: MM_ni870=(/0.001d0,0.005d0,0.002d0,0.003d0,&
       0.008d0,0.006d0,0.001d0,0.003d0,0.002d0,0.007d0,0.006d0,0.017d0,&
       0.002d0,0.005d0,0.004d0,0.012d0,0.002d0,0.026d0,0.002d0,0.002d0,&
       0.008d0,0.012d0,0.022d0,0.015d0,0.011d0,0.008d0,0.004d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_SSA_870=(/0.98d0,0.93d0,0.97d0,0.96d0,&
       0.89d0,0.92d0,0.98d0,0.95d0,0.97d0,0.91d0,0.93d0,0.82d0,0.97d0,&
       0.94d0,0.94d0,0.87d0,0.97d0,0.76d0,0.97d0,0.98d0,0.90d0,0.86d0,&
       0.78d0,0.83d0,0.88d0,0.90d0,0.94d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_g_440=(/0.773d0,0.744d0,0.737d0,0.774d0,&
       0.743d0,0.718d0,0.754d0,0.732d0,0.779d0,0.712d0,0.715d0,0.693d0, &
       0.730d0,0.709d0,0.721d0,0.703d0,0.726d0,0.680d0,0.705d0,0.719d0, &
       0.686d0,0.683d0,0.659d0,0.681d0,0.703d0,0.704d0,0.699d0/)
  REAL*8,DIMENSION(NTYPE) :: MM_g_870=(/0.742d0,0.715d0,0.712d0,0.735d0,&
       0.711d0,0.681d0,0.731d0,0.706d0,0.741d0,0.638d0,0.628d0,0.620d0, &
       0.694d0,0.584d0,0.674d0,0.649d0,0.653d0,0.604d0,0.544d0,0.603d0, &
       0.525d0,0.540d0,0.532d0,0.569d0,0.614d0,0.583d0,0.538d0/)
  contains

  SUBROUTINE MM_REFRACTIVE_INDEX_INTERP(ITYPE,WAVELENGTH_NANO,NR_TEMP,NI_TEMP)
  implicit none
  INTEGER, INTENT(IN) :: ITYPE
  REAL*8, INTENT(IN)::WAVELENGTH_NANO
  REAL*8, INTENT(OUT)::NR_TEMP,NI_TEMP
  REAL*8 :: SLOPE
  IF(ITYPE<1 .OR. ITYPE>NTYPE) STOP 'ITYPE NEEDS TO BE WITHIN 1 AND NTYPE=27'
  IF(WAVELENGTH_NANO<400.0 .OR. WAVELENGTH_NANO>890.0)THEN
     WRITE(*,*)'WAVELENGTH_NANO IN MM_REFRACTIVE_INDEX_INTERP=',WAVELENGTH_NANO
     WRITE(*,*)'STOPPING, IT IS OUT OF THE RANGE OF THE PRE-BUILT DATASET'
  ENDIF

  SLOPE= (MM_nr870(ITYPE)-MM_nr440(ITYPE))/(870.0D0-440.0D0)
  NR_TEMP=MM_nr440(ITYPE)+SLOPE*(WAVELENGTH_NANO-440.0D0)

  SLOPE= (MM_ni870(ITYPE)-MM_ni440(ITYPE))/(870.0D0-440.0D0)
  NI_TEMP=MM_ni440(ITYPE)+SLOPE*(WAVELENGTH_NANO-440.0D0)

  END SUBROUTINE MM_REFRACTIVE_INDEX_INTERP

  SUBROUTINE MM_REFF_CONVERT(ITYPE,MM_REFF_fine,MM_VEFF_fine,&
                             MM_REFF_coarse,MM_VEFF_coarse)
  implicit none
  INTEGER, INTENT(IN) :: ITYPE
  REAL*8, INTENT(OUT) :: MM_REFF_fine,MM_VEFF_fine,&
                         MM_REFF_coarse,MM_VEFF_coarse

	MM_VEFF_fine=exp(MM_sigman_f(ITYPE)*MM_sigman_f(ITYPE))-1
	MM_REFF_fine=MM_rn_f(ITYPE)*((MM_VEFF_fine+1)**2.5d0)

	MM_VEFF_coarse=exp(MM_sigman_c(ITYPE)*MM_sigman_c(ITYPE))-1
	MM_REFF_coarse=MM_rn_c(ITYPE)*((MM_VEFF_coarse+1)**2.5d0)

  END SUBROUTINE MM_REFF_CONVERT

End Module Mie_Scat_Montes
