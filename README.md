RTSOS ‚Äî Radiative Transfer model based on Successive Orders of Scattering
Copyright ¬© 2025 Pengwang Zhai, University of Maryland Baltimore County
This software is released under the Creative Commons Attribution‚ÄìNonCommercial 4.0 International (CC BY-NC 4.0) license.
You are free to use, modify, and share it for research and educational purposes, provided that you give appropriate credit.
Commercial use is not permitted without prior written consent from the author.
üìß For commercial licensing inquiries, contact Pengwang Zhai at [pwzhai@umbc.edu].
üîó Full license text: Creative Commons BY-NC 4.0 (https://creativecommons.org/licenses/by-nc/4.0/)

RTSOS can solve multiple scattering radiative transfer equation from UV, visible, to infrared. It can handle atmosphere-land or atmosphere-ocean coupled systems. The atmosphere can be a mixture of molecules, aerosols, and cloud droplets. The land bottom can be Lambertian, snow surface, Ross-Li, and a number of other surfaces. The ocean waters are modeled by a mixture of pure ocean water, phytoplankton, and colored dissolved, organic matter, and other hydrsols. The sensors can be placed at arbitrary levels in the Earth system. The output of the sensor can include the full polarized Stokes parameters (I, Q, U, V). For more information, see References at the end of this document.


PACE simulator is a wrapper build around the monochromatic RTSOS, which has a list of build-in aerosol and ocean inherent optical properties. A publication on the PACE simulator is published on Frontiers in Remote Sensing (Zhai et al., 2022). 

A collection of data files which are needed for simulating the PACE instruments can be downloaded at: \
http://doi.org/10.5281/zenodo.17410093

The file is named as RTSOS_data_v1.0_20251022.tar.gz, which can be placed in a convenient location of your choice, let's call it PACEDATADIR.

You can extract the files by doing the following in a linux terminal:

cd PACEDATADIR \
tar -xf RTSOS_data_v1.0_20251022.tar.gz

You will get two directories. One is PACEDATADIR/Gas_Absorption_Coefficients/, which contains the gas absorption cross section lookup table for H2O, O2, CH4, CO2, NO2, ozone. This lookup table was generated by using ARTS: The Atmospheric Radiative Transfer Simulator:
(https://www.radiativetransfer.org)version 2.3 with HITRAN2020 database (https://hitran.org/media/refs/HITRAN-2020.pdf).

The other is PACEDATADIR/Data/, which contains the absorption coefficients of pure water, plankton particles, the birectional reflectance distribution functions of snow surface, scattering matrix of dust particles, the instrument response functions of ocean color instrument, HARP2, and SPEXone, and a number of other data files used in the PACE simulator.


RTSOS and the PACE simulator requires a fortran 90 compiler (https://gcc.gnu.org/fortran/), hdf5 (https://www.hdfgroup.org/solutions/hdf5/) and lapack (https://www.netlib.org/lapack/) libraries.

Section 1: COMPILE

The steps to use it is: compile the package, configure the input files, and run the code with the executable file. \
To compile, open a terminal and go to:

$cd RTSOSDIR/compile

where RTSOSDIR is where you clone this repo. Then try to compile the monochromatic code:

$make

If you get an error of missing fortran compiler, examine "Makefile" and specify the correct fortran command to F90. If successful, you have compiled the monochromatic radiative transfer package, which is the core of the PACE simulator.

Now you can edit the PACE Simulator make file to set the hdf5 library paths:

$emacs makefile_PACE_Simulator_DoubleK

Inside makefile_PACE_Simulator_DoubleK, you want to specify the following directories:

HDF5DIR = /usr/local/Cellar/hdf5@1.10/1.10.7\
HDF5LIB=-I$(HDF5DIR)/include\
H5FC=$(HDF5DIR)/bin/h5fc\
LIBSHDF= $(HDF5LIB) -L$(HDF5DIR)/lib/ -lhdf5 -lhdf5_fortran

If these are correctly set, you can compile the pace simulator:

$make clean\
$make -f makefile_PACE_Simulator_DoubleK

This will compile the pace simulator.

Section 2: RUN the MODELS

For monochromatic simulation, users are referred to the documentations located at 
/Documentation/Describtion_of_input_files/SOS_io.pdf

Section 2.1 PACE Simulator

Next we may try out the pace simulator:

$cp rtsos_PACE_Simulator_DoubleK.exe ../test/PACE_Simulator/\
$cd ../test/PACE_Simulator/\
$mkdir alg_test

You can now generate the input files for the simulator with the python scripts for ocean or land surfaces, respectively:

test/PACE_Simulator/python_script/python_script/pace_simulator_twolayer_inputfile_land.py\
test/PACE_Simulator/python_script/python_script/pace_simulator_twolayer_inputfile_ocean.py

Study these two files before you execute them. Most importantly, change aux_dir and gas_absorption_coeff_dir to be:
 
aux_dir='PACEDATADIR/Data/'\
gas_absorption_coeff_dir='PACEDATADIR/Gas_Absorption_Coefficients/'


#run the simulator as:

../rtsos_PACE_Simulator_DoubleK.exe input_rt_pace.txt

where "input_rt_pace.txt" is the input file to the simulator you generated in Step 3 using the python script.

Current version can conveniently generate synthetic datasets for OCI, HARP, and SPEX
for flexible datasets for OCI, HARP, and SPEX for flexible atmospheric and ocean condition. 
The input parameters are specified in input files.

Right now the aerosol models are: IAEROSOL=1-20, where
IAEROSOL=1-10 is the Shettle&Fenn model:

E. P. Shettle and R. W. Fenn, ‚ÄúModels for the aerosols of the lower atmosphere and the effects of humidity variations on their optical properties,‚Äù AFGL-TR 790214, U. S. Air Force Laboratory, Hanscom Air Force Base, Mass. (1979).

and 

IAEROSOL=11-20;\
IRH=1-8 where RH(IRH)=(/0.30,0.50,0.70,0.75,0.80,0.85,0.90,0.95/).

are the new operational aerosol models currently used in the atmospheric correction at GSFC.

Ziauddin Ahmad, Bryan A. Franz, Charles R. McClain, Ewa J. Kwiatkowska, Jeremy Werdell, Eric P. Shettle, and Brent N. Holben, "New aerosol models for the retrieval of aerosol optical thickness and normalized water-leaving radiances from the SeaWiFS and MODIS sensors over coastal regions and open oceans," Appl. Opt. 49, 5545-5560 (2010)

For ocean simulations, ocean inherent optical properties are documented in Zhai et al., (2017, 2018, 2022).

Section 2.2 Single scattering matrix code

If you used IAEROSOL=-99 in the pace simulator input file, you will need to prepare the aerosol phase matrix. A tool was written by Neranga K. Hannadige (https://scholar.google.com/citations?user=0lAwqNsAAAAJ&hl=en) to generate the input scattering matrix files for the pace simulator. To use it, you can do the following:

cd RTSOSDIR/compile\
make -f makefile_aerosol_phmx_cal\
cp Aerosol_Phmx_Cal.exe ../test/PACE_Simulator/alg_test/\
cd ../test/PACE_Simulator/alg_test/\
./Aerosol_Phmx_Cal.exe inputfile_for_aerosol_phase_matrix

where "inputfile_for_aerosol_phase_matrix" is the input file for aerosol phase matrix calculator. You will need to generate inputfile_for_aerosol_phase_matrix by using the script 

PACE_Simulator/python_script/Aerosol_PhaseMatrix_Cal_InputPre.py

In this script, you also want to specify:

aux_dir='PACEDATADIR/Data/'

The single scattering matrix simulation uses the Mie code developed by M. Mishchenko 
(Scattering, absorption, and emission of light by small particles, MI Mishchenko, LD Travis, AA Lacis - 2002)

A non spherical dust scattering matrix database is included, which was provided by Prof. Ping Yang at Texas A&M University (Meng, Z., P. Yang, G. Kattawar, L. Bi, K. Liou, and I. Laszlo, 2010: Single-scattering properties of tri-axial ellipsoidal mineral dust aerosols: A database for application to radiative transfer calculations. J. Aerosol Sci., 41, 501‚Äì512, https://doi.org/10.1016/j.jaerosci.2010.02.008.)

The single scattering matrix code assumes either bimodal (NMODE=2) or trimodal (NMODE=3) size distribution, see the following structure:
----------------------------------------------------------------------
NMODE=2
----------------------------------------------------------------------
Available aerosol modes: 

	*fine mode 		(fmfrac)
		dust like 		(rf1)
		water soluble 	(rf2)
		BrC 			(rf3)
		soot			(1-(rf1+rf2+rf3))
	
	*coarse mode 	(1-fmfrac)
		sea salt		(cmsfrac)
		dust			(1-cmsfrac)

----------------------------------------------------------------------
NMODE=3
----------------------------------------------------------------------
Available aerosol modes:

	*fine mode		(fmfrac)
		water soluble 	(rf2)
		BrC 			(rf3)
		soot			(1-(rf2+rf3))

	*dust mode		(dustfrac)
		dust like		(dsfrac)
		dust			(1-dsfrac)

	*coarse mode 	(1-(fmfrac+dustfrac))
		coarse mode includes sea slat only

----------------------------------------------------------------------


*Note: Different sets of parameters are used for nmode=2 and nmode=3 
		For nmode=2 dustfrac and dsfrac do not exist
		For nmode=3 rf1 and cmsfrac do not exist

References:

Zhai, P., Hu, Y., Trepte, C. R., Lucker, P. L. (2009). A vector radiative transfer model for coupled atmosphere and ocean systems based on successive order of scattering method. Optics express, 17(4), 2057-2079.

Zhai, P., Hu, Y., Chowdhary, J., Trepte, C. R., Lucker, P. L., Josset, D. B. (2010). A vector radiative transfer model for coupled atmosphere and ocean systems with a rough interface. Journal of Quantitative Spectroscopy and Radiative Transfer, 111(7), 1025-1040.

Zhai, P., Hu, Y., Josset, D. B., Trepte, C. R., Lucker, P. L., Lin, B. (2013). Advanced angular interpolation in the vector radiative transfer for coupled atmosphere and ocean systems. Journal of Quantitative Spectroscopy and Radiative Transfer, 115, 19-27.

Zhai, P., Hu, Y., Winker, D. M., Franz, B., Boss, E. (2015). Contribution of Raman scattering to polarized radiation field in ocean waters. Optics Express, 23(18), 23582-23596.

Zhai, P., Hu, Y., Winker, D. M., Franz, B., WERDELL, J., BOSS, E. (2017). Inelastic vector radiative transfer solution in ocean waters. Optics Express, 25, A223-A239. 

Zhai, P., Boss, E., Franz, B., Werdell, J., Hu, Y. (2018). Radiative transfer modeling of phytoplankton fluorescence quenching  processes. MDPI Remote Sensing, 10(8), 1039.

Zhai, P., Hu, Y. (2022). An improved pseudo spherical shell algorithm for vector radiative transfer. Journal of Quantitative Spectroscopy and Radiative Transfer, 282, 108132. https://www.sciencedirect.com/science/article/pii/S0022407322000693.

Zhai, P., Gao, M., Franz, B. A., Werdell, P. J., Ibrahim, A., Hu, Y., Chowdhary, J. (2022). A Radiative Transfer Simulator for PACE: Theory and Applications. Frontiers in Remote Sensing, 3. https://www.frontiersin.org/article/10.3389/frsen.2022.840188.
